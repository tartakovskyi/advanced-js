<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Github users</title>
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="root"></div>

    <script
      crossorigin
      src="https://unpkg.com/react@16.8.3/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@16.8.3/umd/react-dom.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/prop-types@15.7.2/prop-types.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"
    ></script>

    <script type="text/babel">
    const root = document.getElementById("root");

class Form extends React.Component {
  state = {
    value: "",
  };

  update = event => this.setState({ value: event.target.value })

  handleSubmit = event => {
    event.preventDefault();
    this.props.submit(this.state.value);
    this.setState({ value: "" });
  }

  render() {
    return (
            <form onSubmit={this.handleSubmit}>
              <div className="form-box">
                <div className="form-box__item">
                  <input
                      type="text"
                      value={this.state.value}
                      onChange={this.update}
                  />
                  <button>Add user</button>
                </div>
              </div>
            </form>
    )
  }
}

const Cart = ({ profile }) => (
        <div className="cart">
          <h3>{profile.name}</h3>
          <p>{profile.login}</p>
          <img src={profile.avatar_url} alt="https://placehold.it/75"/>
        </div>
)

const CartList = ({ data }) => (
        <div className="cart-box">
          {data.map(profile => (
            <Cart key={profile.id} profile={profile} />
          ))}
        </div>
)

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { error: null, errorInfo: null };
  }
  
  componentDidCatch(error, errorInfo) {
    this.setState({
      error: error,
      errorInfo: errorInfo
    })
  }
  
  render() {

    if (this.state.errorInfo) {
      
      return (
        <div>
          <h2>Something went wrong.</h2>
          <details style={{ whiteSpace: 'pre-wrap' }}>
            {this.state.error && this.state.error.toString()}
            <br />
            {this.state.errorInfo.componentStack}
          </details>
        </div>
      );
    }
    
    return this.props.children;
  }  
}

class App extends React.Component {
  state = {
    data: []
  }

  addUser = async userName => {
    const url =`https://api.github.com/users/${userName}`;
    const response = await fetch(url);
    if (response.status == 404) {
      throw new Error('User not found');
    } else {
      const user = await response.json();
      this.setState({ data: [...this.state.data, user] });
    }    
  }

  render() {
    return (
      <div className="container">
        <ErrorBoundary>
          <Form submit={this.addUser} />
          <CartList data={this.state.data}/>
        </ErrorBoundary>
      </div>
    )
  }
}

ReactDOM.render(<App />, root);
    </script>
  </body>
</html>
